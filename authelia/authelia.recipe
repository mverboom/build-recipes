[INFO]
arch=amd64

[VERSION]
B_GITVER https://github.com/authelia/authelia

[REQUIRED]
golang-B_PF devscripts equivs yarn-B_PF nodejs-14-B_PF

[BUILD]
export GOPATH=$(pwd)
B_GET git https://github.com/authelia/authelia authelia
cd authelia
pushd web
yarn install --frozen-lockfile
yarn build
popd
mv api internal/server/public_html/api
sed -i "/^var BuildCommit/ s/\".*\"/\"$(git rev-parse --verify v${B_VERSION})\"/" internal/utils/version.go
sed -i "/^var BuildTag/ s/\".*\"/\"v${B_VERSION}\"/" internal/utils/version.go
export GOROOT=/opt/go
export PATH=${PATH}:${GOROOT}/bin
go build -ldflags '-w' -trimpath -o authelia cmd/authelia/*.go
install -Dm755 "authelia" "$B_INSTALLDIR/opt/authelia/bin/authelia"
install -Dm755 "config.template.yml" "$B_INSTALLDIR/etc/authelia/configuration.template.yml"
B_LINKFILES /opt/authelia/bin /usr/bin

[PKG]
type=deb
torepo=y

[DEB]
Package: authelia
Version: B_VERSION
Section: authelia
Priority: optional
Architecture: B_ARCH
Maintainer: B_MAIL
Description: Authelia custom B_ORG build
Homepage: https://www.authelia.com/
