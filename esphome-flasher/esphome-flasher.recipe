[VERSION]
# weird repository tagging
B_GITVER -i 1.[0-9].[0-9] https://github.com/esphome/esphome-flasher

[INFO]
arch=amd64

[REQUIRED]
python3 python3-pip pkg-config libgtk-3-dev python3-serial python3-cryptography python3-ecdsa python3-idna python3-urllib3 python3-bitstring python3-numpy python3-venv

[BUILD]
B_GET git https://github.com/esphome/esphome-flasher esphome-flasher
cd esphome-flasher
git checkout $B_VERSION
DIR=/opt/esphome-flasher
DEST=$B_INSTALLDIR/opt/$DIR
python3 -m venv $DEST
source $DEST/bin/activate
pip install setuptools
pip install -r requirements.txt
python3 setup.py install
deactivate
pushd "$DEST/bin"
shopt -s extglob
sed -i "s|$DEST|$NAME|g" !(__pycache__)
popd
B_LINKFILE /opt/esphome-flasher/bin/esphomeflasher /usr/bin

[PKG]
type=deb
torepo=y

[DEB]
Package: esphome-flasher
Version: B_VERSION
Section: esphome-flasher
Priority: optional
Architecture: B_ARCH
Maintainer: B_MAIL
Description: ESPHome-flasher custom B_ORG build
Homepage: https://github.com/esphome/esphome-flasher
Depends: python3, python3-serial, python3-cryptography, python3-ecdsa, python3-idna, python3-urllib3, python3-bitstring, python3-numpy
